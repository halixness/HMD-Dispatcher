version: "3.1"

rules:

# =========== General info form
- rule: needs ambulance > general info
  condition:
  - active_loop: form_general_info
  - slot_was_set:
    - pain_type: null
  steps:
  - action: form_general_info
  - active_loop: null
  - slot_was_set:
    - requested_slot: null
  - action: action_submit_patient_coordinates
  - action: utter_proceed_asking_pain

- rule: medical questions > needs ambulance > yes
  condition:
  - active_loop: form_general_info
  - slot_was_set:
    - pain_type: some pain
  steps:
  - action: form_general_info
  - active_loop: null
  - slot_was_set:
    - requested_slot: null
  - action: action_submit_patient_coordinates
  - action: utter_confirm_ambulance_sent
  - action: utter_ask_any_questions

# =========== Emergency form
- rule: need ambulance > medical questions
  condition:
  - active_loop: form_medical_questions
  - slot_was_set:
    - patient_homeaddr: address
    - patient_phonenmbr: 123
  steps:
  - action: form_medical_questions
  - active_loop: null
  - slot_was_set:
    - requested_slot: null
  - action: action_submit_emergency_form
  - action: utter_medical_questions_filled
  - action: utter_confirm_ambulance_sent

- rule: medical questions > ask for ambulance
  condition:
  - active_loop: form_medical_questions
  - slot_was_set:
    - patient_homeaddr: null
    - patient_phonenmbr: null
  steps:
  - action: form_medical_questions
  - active_loop: null
  - slot_was_set:
    - requested_slot: null
  - action: action_submit_emergency_form
  - action: utter_medical_questions_filled
  - action: utter_ask_dispatch_ambulance

# ======================================================
#  Error handling
# ======================================================

- rule: Ask the user to rephrase whenever they send a message with low NLU confidence
  steps:
  - intent: nlu_fallback
  - action: utter_please_rephrase