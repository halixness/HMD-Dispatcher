version: "3.1"

# Sources:
# https://rasa.com/docs/rasa/stories/#checkpoints
# https://rasa.com/docs/rasa/forms/#writing-stories--rules-for-unhappy-form-paths
# https://rasa.com/docs/rasa/responses/#conditional-response-variations

# Notes:
#
# unhappy paths:
# - provides pathology first
# - provides home address first
# - provides phone number first

stories:

- story: greeting
  steps:
    - intent: greet
    - action: utter_greet
    - checkpoint: did_greet

- story: greed > reports pain
  steps:
    - checkpoint: did_greet
    - action: utter_question_issue
    - intent: patient_reports_pain

- story: greed > needs ambulance
  steps:
    - checkpoint: did_greet
    - action: utter_question_issue
    - intent: patient_needs_ambulance
    - action: utter_please_provide_general_info
    - action: form_general_info
    - active_loop: form_general_info

- story: needs ambulance > general info
  steps:
    - intent: patient_needs_ambulance
    - action: utter_please_provide_general_info
    - action: form_general_info
    - active_loop: form_general_info

- story: reports unknown pain
  steps:
    - intent: patient_reports_pain
    - slot_was_set:
      - pain_type: null
    - action: utter_please_rephrase

- story: greeting by reporting pain > medical questions
  steps:
    - intent: patient_reports_pain
      entities:
        - pain_type: pain
    - action: utter_will_ask_medical_questions
    - action: form_medical_questions
    - active_loop: form_medical_questions

- story: medical questions > ask ambulance > yes
  steps:
    - action: utter_medical_questions_filled
    - action: utter_ask_dispatch_ambulance
    - intent: affirmative
    - action: form_general_info
    - active_loop: form_general_info

- story: medical questions > ask ambulance > no
  steps:
    - action: utter_medical_questions_filled
    - action: utter_ask_dispatch_ambulance
    - intent: negative
    - action: utter_ask_any_questions

- story: ask any questions > no > goodbye
  steps:
    - action: utter_ask_any_questions
    - intent: negative
    - action: utter_goodbye

- story: ask any questions > no > goodbye
  steps:
    - action: utter_ask_any_questions
    - intent: affirmative
    - action: utter_start_QA

# ========== Interruptions

- story: ask dispatch ambulance > needs human agent
  steps:
    - action: utter_ask_dispatch_ambulance
    - intent: patient_wants_human_agent
    - action: utter_transferring_to_human

- story: ask any questions > needs human agent
  steps:
    - action: utter_ask_any_questions
    - intent: patient_wants_human_agent
    - action: utter_transferring_to_human

- story: anytime speak with human agent
  steps:
    - intent: patient_wants_human_agent
    - action: utter_transferring_to_human

- story: ask human agent during form (1)
  steps:
    - action: utter_please_provide_general_info
    - action: form_general_info
    - active_loop: form_general_info
    - intent: patient_wants_human_agent
    - action: action_deactivate_loop
    - active_loop: null
    - action: utter_transferring_to_human

- story: ask human agent during form (2)
  steps:
    - action: utter_will_ask_medical_questions
    - action: form_medical_questions
    - active_loop: form_medical_questions
    - intent: patient_wants_human_agent
    - action: action_deactivate_loop
    - active_loop: null
    - action: utter_transferring_to_human