version: "3.1"

# Sources:
# https://rasa.com/docs/rasa/stories/#checkpoints
# https://rasa.com/docs/rasa/forms/#writing-stories--rules-for-unhappy-form-paths
# https://rasa.com/docs/rasa/responses/#conditional-response-variations

# Notes:
#
# unhappy paths:
# - provides pathology first
# - provides home address first
# - provides phone number first

stories:

- story: greeting
  steps:
    - intent: greet
    - action: utter_greet
    - checkpoint: did_greet

- story: greed > reports pain
  steps:
    - checkpoint: did_greet
    - action: utter_question_issue
    - intent: patient_reports_pain

- story: greed > needs ambulance
  steps:
    - checkpoint: did_greet
    - action: utter_question_issue
    - intent: patient_needs_ambulance
    - action: utter_please_provide_general_info
    - action: form_general_info
    - active_loop: form_general_info

- story: needs ambulance > general info
  steps:
    - intent: patient_needs_ambulance
    - action: utter_please_provide_general_info
    - action: form_general_info
    - active_loop: form_general_info

- story: medical questions > ask ambulance > yes
  steps:
    - checkpoint: completed_medical_questions
    - action: utter_medical_questions_filled
    - action: utter_ask_dispatch_ambulance
    - intent: affirmative
    - action: form_general_info
    - active_loop: form_general_info

- story: medical questions > ask ambulance > no
  steps:
    - checkpoint: completed_medical_questions
    - action: utter_medical_questions_filled
    - action: utter_ask_dispatch_ambulance
    - intent: negative
    - action: utter_ask_any_questions

- story: ask any questions > no > goodbye
  steps:
    - action: utter_ask_any_questions
    - intent: negative
    - action: utter_goodbye

- story: ask any questions > no > goodbye
  steps:
    - action: utter_ask_any_questions
    - intent: affirmative
    - action: utter_start_QA

# ========== Abdominal pain
- story: report abdominal pain
  steps:
    - intent: patient_reports_pain
      entities:
        - abdominal_pain: value
    - action: utter_will_ask_medical_questions
    - action: utter_ask_pain_duration
    - intent: inform_pain_duration
      entities:
        - pain_duration: value
    - action: positive_conv_marker
    - action: utter_ask_pain_severity
    - intent: inform_pain_severity
      entities:
        - pain_severity: value
    - action: positive_conv_marker
    - action: utter_ask_abdominal_pain_area
    - intent: inform_abdominal_pain_area
      entities:
        - abdominal_pain_area: value
    - action: positive_conv_marker
    - action: utter_ask_abdominal_other_symptoms
    - intent: inform_abdominal_other_symptoms
      entities:
        - abdominal_other_symptoms: value
    - action: utter_medical_questions_filled
    - checkpoint: completed_medical_questions

- story: abdominal pain - negative answ (1)
  steps:
    - action: utter_ask_abdominal_pain_area
    - intent: negative
    - action: negative_conv_marker
    - action: utter_ask_abdominal_other_symptoms

- story: abdominal pain - negative answ (2)
  steps:
    - action: inform_abdominal_other_symptoms
    - intent: negative
    - action: negative_conv_marker
    - action: utter_medical_questions_filled
    - checkpoint: completed_medical_questions


# ========== Respiratory difficulty 
- story: report respiratory difficulty
  steps:
    - intent: patient_reports_pain
      entities:
        - respiratory_difficulty: value
    - action: utter_will_ask_medical_questions
    - action: utter_ask_pain_duration
    - intent: inform_pain_duration
      entities:
        - pain_duration: value
    - action: positive_conv_marker
    - action: utter_ask_pain_severity
    - intent: inform_pain_severity
      entities:
        - pain_severity: value
    - action: positive_conv_marker
    - action: utter_ask_resp_difficulty_nature
    - intent: inform_resp_difficulty_nature
      entities:
        - resp_difficulty_nature: value
    - action: positive_conv_marker
    - action: utter_ask_resp_difficulty_triggers
    - intent: inform_resp_difficulty_triggers
      entities:
        - resp_difficulty_triggers: value
    - action: positive_conv_marker
    - action: utter_ask_resp_difficulty_exposure
    - intent: inform_resp_difficulty_exposure
      entities:
        - resp_difficulty_exposure: value
    - action: positive_conv_marker
    - action: utter_medical_questions_filled
    - checkpoint: completed_medical_questions

- story: resp difficulty - negative answ (1)
  steps:
    - action: utter_ask_resp_difficulty_triggers
    - intent: negative
    - action: negative_conv_marker
    - action: utter_ask_resp_difficulty_exposure

- story: resp difficulty - negative answ (2)
  steps:
    - action: utter_ask_resp_difficulty_exposure
    - intent: negative
    - action: negative_conv_marker
    - action: utter_medical_questions_filled
    - checkpoint: completed_medical_questions

# ========== Fainting 
- story: report fainting
  steps:
    - intent: patient_reports_pain
      entities:
        - fainting: value
    - action: utter_will_ask_medical_questions
    - action: utter_ask_pain_duration
    - intent: inform_pain_duration
      entities:
        - pain_duration: value
    - action: utter_ask_pain_severity
    - intent: inform_pain_severity
      entities:
        - pain_severity: value
    - action: utter_ask_fainting_prior
    - intent: inform_fainting_prior
      entities:
        - fainting_prior: value
    - action: utter_ask_fainting_patterns
    - intent: inform_fainting_patterns
      entities:
        - fainting_patterns: value
    - action: utter_medical_questions_filled
    - checkpoint: completed_medical_questions

- story: resp difficulty - negative answ (1)
  steps:
    - action: utter_ask_fainting_prior
    - intent: negative
    - action: utter_ask_fainting_patterns

- story: resp difficulty - negative answ (2)
  steps:
    - action: utter_ask_fainting_patterns
    - intent: negative
    - action: utter_medical_questions_filled
    - checkpoint: completed_medical_questions

# ========== Hypothermia 
- story: report hypothermia pain
  steps:
    - intent: patient_reports_pain
      entities:
        - hypothermia: value
    - action: utter_will_ask_medical_questions
    - action: utter_ask_pain_duration
    - intent: inform_pain_duration
      entities:
        - pain_duration: value
    - action: utter_ask_pain_severity
    - intent: inform_pain_severity
      entities:
        - pain_severity: value
    - action: utter_ask_hypothermia_skin_color
    - intent: inform_hypothermia_skin_color
      entities:
        - hypothermia_skin_color: value
    - action: utter_ask_hypothermia_treatment
    - intent: inform_hypothermia_treatment
      entities:
        - hypothermia_treatment: value
    - action: utter_medical_questions_filled
    - checkpoint: completed_medical_questions

# ========== Allergy Reaction
- story: report allergy reaction
  steps:
    - intent: patient_reports_pain
      entities:
        - allergic_reaction: value
    - action: utter_will_ask_medical_questions
    - action: utter_ask_pain_duration
    - intent: inform_pain_duration
      entities:
        - pain_duration: value
    - action: utter_ask_pain_severity
    - intent: inform_pain_severity
      entities:
        - pain_severity: value #does every question need to specify the entity??
    - action: utter_ask_allergy_cause
    - intent: inform_aller_cause
    - action: utter_ask_allergy_symptoms
    - intent: inform_aller_symptoms
    - action: utter_ask_allergy_history
    - intent: inform_aller_history
    - action: utter_medical_questions_filled
    - checkpoint: completed_medical_questions
# ============ Fall ==========================
- story: report fall
  steps:
    - intent: patient_reports_pain
      entities:
        - fall: value
    - action: utter_will_ask_medical_questions
    - action: utter_ask_pain_location
    - intent: inform_pain_location
      entities:
        - pain_location: value
    - action: utter_ask_pain_nature
    - intent: inform_pain_nature
    - action: utter_ask_conscious
    - intent: inform_fall_conscious
    - action: utter_ask_movement
    - intent: inform_fall_movement
    - action: utter_medical_questions_filled
    - checkpoint: completed_medical_questions
# ============ fever =============================
- story: report fever
  steps:
    - intent: patient_reports_pain
      entities:
        - fever: value
    - action: utter_will_ask_medical_questions
    - action: utter_ask_pain_duration
    - intent: inform_pain_duration
      entities:
        - pain_duration: value
    - action: utter_ask_pain_symptoms
    - intent: inform_pain_symptoms
    - action: utter_ask_pain_history
    - intent: inform_pain_history
    - action: utter_ask_temperature
    - intent: inform_fever_temperature
    - action: utter_medical_questions_filled
    - checkpoint: completed_medical_questions

# ============== headache ===========================
- story: report headache
  steps:
    - intent: patient_reports_pain
      entities:
        - headache: value
    - action: utter_will_ask_medical_questions
    - action: utter_ask_pain_duration
    - intent: inform_pain_duration
      entities:
        - pain_duration: value
    - action: utter_ask_pain_severity
    - intent: inform_pain_severity
    - action: utter_ask_pain_relieving
    - intent: inform_pain_relieving
    - action: utter_ask_headache_lifestyle
    - intent: inform_headache_lifestyle
    - action: utter_medical_questions_filled
    - checkpoint: completed_medical_questions


# ========== Interruptions

- story: ask dispatch ambulance > needs human agent
  steps:
    - action: utter_ask_dispatch_ambulance
    - intent: patient_wants_human_agent
    - action: utter_transferring_to_human

- story: ask any questions > needs human agent
  steps:
    - action: utter_ask_any_questions
    - intent: patient_wants_human_agent
    - action: utter_transferring_to_human

- story: anytime speak with human agent
  steps:
    - intent: patient_wants_human_agent
    - action: utter_transferring_to_human

- story: ask human agent during form (1)
  steps:
    - action: utter_please_provide_general_info
    - action: form_general_info
    - active_loop: form_general_info
    - intent: patient_wants_human_agent
    - action: action_deactivate_loop
    - active_loop: null
    - action: utter_transferring_to_human